
&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	//++ 13.03.2018 Веденеев П. //отключение непосредственного изменения данных
	Если ПолучитьФункциональнуюОпцию("ИспользоватьБизнесПроцессыДляКорректировкиСправочников") И КоманднаяПанель.ПодчиненныеЭлементы.ФормаОбщаяКомандаАкцептоватьИзмененияВСправочнике.Видимость Тогда
	
		Отказ = Истина;
		Возврат;
	
	КонецЕсли;
	
	//+ Савинов
	
	// Поскольку под заголовком Наименование скрывается Наименование полное, оно и будет проверяться
	
	
	//Если СлужебныеФункции.НайтиДубльСправочникаПоНаименованию(ТекущийОбъект.Ссылка, ТекущийОбъект.Наименование) Тогда
	//	
	//	Сообщить("В справочнике уже есть элемент с таким наименованием!", СтатусСообщения.Важное);
	//	Отказ = Истина;
	//	Возврат;
	//	
	//КонецЕсли; 
	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	ОКЕИ.Ссылка
	|ИЗ
	|	Справочник.ОКЕИ КАК ОКЕИ
	|ГДЕ
	|	ОКЕИ.НаименованиеПолное = &НаименованиеПолное
	|	И НЕ ОКЕИ.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ТекущийОбъект.Ссылка);
	Запрос.УстановитьПараметр("НаименованиеПолное", ТекущийОбъект.НаименованиеПолное);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если Не РезультатЗапроса.Пустой() Тогда
	
		Сообщить("В справочнике уже есть элемент с таким наименованием!", СтатусСообщения.Важное);
		Отказ = Истина;
		Возврат;	
	
	КонецЕсли;
	
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	ОКЕИ.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.ОКЕИ КАК ОКЕИ
	|ГДЕ
	|	ОКЕИ.Код = &Код
	|	И НЕ ОКЕИ.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", ТекущийОбъект.Ссылка);
	Запрос.УстановитьПараметр("Код", ТекущийОбъект.Код);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если Не РезультатЗапроса.Пустой() Тогда
	
		Сообщить("В справочнике уже есть элемент с таким кодом!", СтатусСообщения.Важное);
		Отказ = Истина;
		Возврат;	
	
	КонецЕсли;
	
	//- Савинов
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	//++ 13.03.2018 Веденеев П. //отключение непосредственного изменения данных
	КорректировкаДанныхСправочников.ОтключитьНепосредственноеИзменениеДанных(ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	//++ 13.03.2018 Веденеев П. //отключение непосредственного изменения данных
	КорректировкаДанныхСправочников.ОтключитьНепосредственноеИзменениеДанных(ЭтаФорма);
	
КонецПроцедуры
