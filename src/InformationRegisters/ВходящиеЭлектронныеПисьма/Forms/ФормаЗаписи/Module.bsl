
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Вложение = Запись.ИмяФайла;
	
	Элементы.Вложение.Видимость = (НЕ Вложение = "");
	
КонецПроцедуры

&НаСервере
Функция ПоместитьВложениеВовременноеХранилище()
	
	РеквизитОбъект = РеквизитФормыВЗначение("Запись");
	ФайлВложение = РеквизитОбъект.Вложение.Получить();
	Если ФайлВложение = Неопределено Тогда
		Возврат "";
	Иначе 
		Возврат ПоместитьВоВременноеХранилище(ФайлВложение);
	КонецЕсли; 

КонецФункции
 
&НаКлиенте
Асинх Процедура ВложениеНажатие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Адрес = ПоместитьВложениеВовременноеХранилище();

	Если Адрес = "" Тогда
		Возврат;
	КонецЕсли; 
	
	ФайлВложение = ПолучитьИзВременногоХранилища(Адрес);
	//ИмяФайла = КаталогВременныхФайлов() + Запись.ИмяФайла;
	Обещание = КаталогВременныхФайловАсинх();
	РезультатАсинх = Ждать Обещание;
	ИмяФайла = РезультатАсинх + Запись.ИмяФайла;
	
	Ждать ФайлВложение.ЗаписатьАсинх(ИмяФайла);
	Вложение = Запись.ИмяФайла;
	
	ЗапуститьПриложениеАсинх(ИмяФайла);
	
КонецПроцедуры
 